{% extends "page_layout.html" %}
{% load i18n %}

{% block head %}
{{ block.super }}

<script type="text/javascript">
$( document ).ready(function() {
    $("#service_register_form").submit(function(e) {
        $("#responseDiv").hide();
        $("#tableDiv").hide();
        $(".error").hide();
        $("#dataTable").html("");
        e.preventDefault();
        var url = $("#service_register_form").attr( "action" );
        $.ajax({
            type: "POST",
            url: url,
            dataType: "json",
            data: $("#service_register_form").serialize(), // serializes the form's elements.
            success: function(data)
            {

                if (data.available_layers) {
                    $.each(data.available_layers,function(i,row){
                        $('<tr>').attr('id',i).
                                append($('<td>').text(row[0])).
                                append($('<td>').text(row[1])).appendTo('#dataTable');
                    });
                    $("#tableDiv").show();
                }
                if (data.service_id) {
                    $('#service_link').attr('href', "/services/" +
                            data.service_id).text(data.service_title||data.service_name);
                }
                else {
                    $("#responseDiv").html(data.msg);
                }
                $("#responseDiv").show();
            },
            error: function(data) {
                $(".error").html(data.responseText);
                $(".error").show();
            }
        });

        return false; // avoid to execute the actual submit of the form.
    });
});
</script>


{% endblock %}

{% block title %} Register Service - {{ block.super }} {% endblock %}

{% block main %}
<div class="twocol">

<h2>Register New Service</h2>
    <form method="POST" id="service_register_form">
    {% csrf_token %}
    <ul class="form">
        {{ create_service_form.as_ul }}
    </ul>
    <div align="center"><p><input type="submit" class="submit_btn" value="{% trans "Create" %}" /></p></div>
    </form>

    <div id="responseDiv" style="display:none;">
        <h4>{%  trans "Service has been created:" %}</h4>
        <h4><a id="service_link"></a>.</h4>
        <p>{%  trans "Layers are being imported and will soon be available through Worldmap's search interface." %}.</p>
    </div>

    <div class="error" style="display:none;">
    </div>

    <div id="tableDiv" style="display:none;">
        <p><a id="service_link">{%  trans "The following layers will be imported" %}</a></p>
        <table id="dataTable"></table>
    </div>
</div>
{% endblock %}
